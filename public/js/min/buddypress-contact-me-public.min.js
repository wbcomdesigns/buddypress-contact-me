($=>{$(document).ready(function(){bcm_ajax_object.is_buddyboss_active&&(count='<span class="count">'+bcm_ajax_object.contact_count+"</span>",$("#user-bp_contact_count").append(count)),checkFormValidity();var charCount,maxLength,count=$(".bp_contact_me_msg");function validateField($field){var value=$field.val().trim(),minLength=parseInt($field.attr("minlength"))||0,maxLength=parseInt($field.attr("maxlength"))||1/0,isValid=!0,errorMessage="";return $field.removeClass("bcm-error"),$field.next(".bcm-error-message").remove(),$field.prop("required")&&!value?(isValid=!1,errorMessage=bcm_ajax_object.field_required||"This field is required"):value&&value.length<minLength?(isValid=!1,errorMessage=(bcm_ajax_object.min_length||"Minimum {min} characters required").replace("{min}",minLength)):value&&value.length>maxLength&&(isValid=!1,errorMessage=(bcm_ajax_object.max_length||"Maximum {max} characters allowed").replace("{max}",maxLength)),isValid||($field.addClass("bcm-error"),$field.after('<span class="bcm-error-message">'+errorMessage+"</span>")),isValid}function validateCaptcha(){var captchaInput=$('input[name="bcm_captcha_answer"]'),submitButton=$(".bp-contact-me-btn");if(parseInt(captchaInput.val())===parseInt(submitButton.data("captcha")))return captchaInput.removeClass("bcm-error"),captchaInput.next(".bcm-error-message").remove(),1;captchaInput.val()&&(captchaInput.addClass("bcm-error"),captchaInput.next(".bcm-error-message").length||captchaInput.after('<span class="bcm-error-message">'+(bcm_ajax_object.captcha_error||"Incorrect answer")+"</span>"))}function checkFormValidity(){var isValid=!0,userlog=bcm_ajax_object.user_log;$(".bp-contact-me-form input[required], .bp-contact-me-form textarea[required]").each(function(){$(this).val().trim()||$(this).hasClass("captcha-control")||"bcm_captcha_answer"===$(this).attr("name")||(isValid=!1)}),0!=userlog||(userlog=$(".bp_contact_me_email").val())&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(userlog)||(isValid=!1),(isValid=validateCaptcha()?isValid:!1)?$(".bp-contact-me-btn").prop("disabled",!1).removeClass("not-allowed"):$(".bp-contact-me-btn").prop("disabled",!0).addClass("not-allowed")}count.length&&(charCount=count.val().length,maxLength=count.attr("maxlength"),count.closest(".bp-content-me-fieldset").find(".bcm-char-count").text(charCount+"/"+maxLength)),$(".bp_contact_me_msg").on("input",function(){var charCount=$(this).val().length,maxLength=$(this).attr("maxlength");$(this).closest(".bp-content-me-fieldset").find(".bcm-char-count").text(charCount+"/"+maxLength),.9*maxLength<charCount?$(this).closest(".bp-content-me-fieldset").find(".bcm-char-count").addClass("bcm-warning"):$(this).closest(".bp-content-me-fieldset").find(".bcm-char-count").removeClass("bcm-warning"),checkFormValidity()}),$(".bp_contact_me_email").on("blur",function(){var email=$(this).val();email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)?($(this).addClass("bcm-error"),$(this).next(".bcm-error-message").length||$(this).after('<span class="bcm-error-message">'+(bcm_ajax_object.email_error||"Please enter a valid email address")+"</span>")):($(this).removeClass("bcm-error"),$(this).next(".bcm-error-message").remove()),checkFormValidity()}),$(".bp_contact_me_first_name, .bp_contact_me_login_name, .bp_contact_me_subject").on("input blur",function(){validateField($(this)),checkFormValidity()}),$(".bp-contact-me-form").length&&(charCount=document.querySelector('input[name="bcm_captcha_answer"]'))&&charCount.addEventListener("input",function(e){validateCaptcha()}),$(".bp-contact-me-form").on("submit",function(e){if(!(()=>{var isValid=!0,$emailField=($(".bp-contact-me-form input[required], .bp-contact-me-form textarea[required]").each(function(){"bcm_captcha_answer"===$(this).attr("name")||validateField($(this))||(isValid=!1)}),$(".bp_contact_me_email"));return $emailField.length&&($emailField=$emailField.val())&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test($emailField)&&(isValid=!1),validateCaptcha()||(isValid=!1,$('input[name="bcm_captcha_answer"]').focus()),isValid})())return e.preventDefault(),!1;$(".bcm-submit-spinner").show(),$(".bp-contact-me-btn").prop("disabled",!0)}),$(document).on("click",".bcm_message_delete",function(e){e.preventDefault();var e=$(this),rowid=e.data("id"),nonce=e.data("nonce"),$row=e.closest("tr");confirm(bcm_ajax_object.delete_confirm||"Are you sure you want to delete this message?")&&$.ajax({url:bcm_ajax_object.ajax_url,type:"post",data:{action:"bcm_message_del",rowid:rowid,nonce:nonce},beforeSend:function(){$row.css("opacity","0.5")},success:function(data){data.success?$row.fadeOut(300,function(){var currentCount;$(this).remove(),0<(currentCount=parseInt($("#bp_contact_count .count").text())||0)&&(currentCount--,$("#bp_contact_count .count").text(currentCount),bcm_ajax_object.is_buddyboss_active)&&$("#user-bp_contact_count .count").text(currentCount),0===$(".bp_contact-me-messages tbody tr").length&&location.reload()}):($row.css("opacity","1"),alert(data.data&&data.data.message?data.data.message:bcm_ajax_object.delete_error||"Error deleting message. Please try again."))},error:function(){$row.css("opacity","1"),alert(bcm_ajax_object.delete_error||"Error deleting message. Please try again.")}})}),$("#bcm-bulk-manage").attr("disabled","disabled"),$("#bcm-select").on("change",function(){$("#bcm-bulk-manage").attr("disabled",$(this).val().length<=0)}),$("#bcm-select-all-contact").on("click",function(){$(".bcm-all-check").prop("checked",this.checked)}),$(document).on("click",".bcm_message_seen",function(e){e.preventDefault(),$(".bp-contact-me-loader").css("display","block");e=$(this).data("id");$.ajax({url:bcm_ajax_object.ajax_url,type:"post",data:{action:"bcm_message_popup",rowid:e,nonce:bcm_ajax_object.ajax_nonce},success:function(response){$(".bp-contact-me-loader").css("display","none"),response.success&&Swal.fire({html:response.data.html,width:"600px",showCloseButton:!0,confirmButtonText:bcm_ajax_object.close_text||"Close"})},error:function(){$(".bp-contact-me-loader").css("display","none"),alert(bcm_ajax_object.popup_error||"Error loading message. Please try again.")}})}),$(document).on("change keyup",".bp-contact-me-fields",function(e){var isValid=!0;validateCaptcha()||(isValid=!1),console.log(isValid),isValid?$(".bp-contact-me-btn").prop("disabled",!1).removeClass("not-allowed"):$(".bp-contact-me-btn").prop("disabled",!0).addClass("not-allowed")})})})(jQuery);